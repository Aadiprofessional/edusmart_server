-- Create case_studies table
CREATE TABLE IF NOT EXISTS case_studies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(200) NOT NULL,
    subtitle VARCHAR(300),
    description TEXT NOT NULL,
    student_name VARCHAR(100) NOT NULL,
    student_image TEXT,
    student_background TEXT,
    previous_education TEXT,
    target_program VARCHAR(200),
    target_university VARCHAR(200),
    target_country VARCHAR(100),
    outcome VARCHAR(20) NOT NULL CHECK (outcome IN ('accepted', 'scholarship', 'rejected', 'waitlisted', 'in-progress')),
    scholarship_amount DECIMAL(12,2),
    scholarship_currency VARCHAR(10) DEFAULT 'USD',
    application_year INTEGER,
    story_content TEXT NOT NULL, -- Main story content
    challenges_faced TEXT[],
    strategies_used TEXT[],
    advice_given TEXT[],
    timeline JSONB, -- Application timeline with milestones
    test_scores JSONB, -- GRE, IELTS, TOEFL, etc.
    documents_used TEXT[], -- List of documents prepared
    featured BOOLEAN DEFAULT FALSE,
    category VARCHAR(50) NOT NULL CHECK (category IN ('undergraduate', 'graduate', 'phd', 'scholarship', 'visa', 'career-change')),
    field_of_study VARCHAR(100),
    tags TEXT[] DEFAULT '{}',
    reading_time INTEGER, -- Estimated reading time in minutes
    views INTEGER DEFAULT 0,
    likes INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'published' CHECK (status IN ('draft', 'published', 'archived')),
    created_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_case_studies_category ON case_studies(category);
CREATE INDEX IF NOT EXISTS idx_case_studies_outcome ON case_studies(outcome);
CREATE INDEX IF NOT EXISTS idx_case_studies_featured ON case_studies(featured);
CREATE INDEX IF NOT EXISTS idx_case_studies_status ON case_studies(status);
CREATE INDEX IF NOT EXISTS idx_case_studies_country ON case_studies(target_country);
CREATE INDEX IF NOT EXISTS idx_case_studies_field ON case_studies(field_of_study);
CREATE INDEX IF NOT EXISTS idx_case_studies_created_at ON case_studies(created_at);
CREATE INDEX IF NOT EXISTS idx_case_studies_views ON case_studies(views);

-- Create a GIN index for tags array for better search performance
CREATE INDEX IF NOT EXISTS idx_case_studies_tags ON case_studies USING GIN(tags);

-- Create a text search index for title, description, and story content
CREATE INDEX IF NOT EXISTS idx_case_studies_search ON case_studies USING GIN(to_tsvector('english', title || ' ' || description || ' ' || story_content));

-- Add RLS (Row Level Security) policies
ALTER TABLE case_studies ENABLE ROW LEVEL SECURITY;

-- Policy to allow public read access for published case studies
CREATE POLICY "Allow public read access" ON case_studies
    FOR SELECT USING (status = 'published');

-- Policy to allow admin users to insert/update/delete
CREATE POLICY "Allow admin full access" ON case_studies
    FOR ALL USING (true);

-- Add some sample data
INSERT INTO case_studies (title, subtitle, description, student_name, student_image, student_background, previous_education, target_program, target_university, target_country, outcome, scholarship_amount, application_year, story_content, challenges_faced, strategies_used, advice_given, timeline, test_scores, featured, category, field_of_study, tags, reading_time, created_by) VALUES
('From Engineering to MIT: A Data Science Journey', 'How I transitioned from mechanical engineering to land a spot at MIT for my Master''s in Data Science', 'A comprehensive case study of transitioning from mechanical engineering to data science and successfully getting admitted to MIT with a partial scholarship.', 'Priya Sharma', 'https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'Mechanical Engineer with 3 years of industry experience in automotive sector', 'B.Tech in Mechanical Engineering from IIT Delhi (GPA: 8.7/10)', 'Master of Science in Data Science', 'Massachusetts Institute of Technology (MIT)', 'United States', 'scholarship', 25000.00, 2023, 'My journey from mechanical engineering to data science wasn''t straightforward, but it was incredibly rewarding. After working for three years in the automotive industry, I realized my passion lay in analyzing data patterns and building predictive models. The transition required significant preparation, including self-learning programming languages, taking online courses, and building a portfolio of data science projects. The application process was rigorous, requiring strong test scores, compelling essays, and relevant experience. Through persistence and strategic planning, I not only got accepted to MIT but also received a partial scholarship covering 40% of my tuition fees.', ARRAY['Career transition from different field', 'Limited formal data science education', 'Competitive admission process', 'Financial constraints'], ARRAY['Self-taught programming (Python, R)', 'Completed online certifications', 'Built portfolio projects', 'Networked with professionals', 'Prepared extensively for GRE'], ARRAY['Start preparing at least 18 months in advance', 'Build a strong portfolio with real projects', 'Network with current students and alumni', 'Tailor your SOP to each program', 'Don''t underestimate the importance of test scores'], '{"milestones": [{"date": "2022-01", "event": "Started GRE preparation"}, {"date": "2022-04", "event": "Took GRE (Score: 325)"}, {"date": "2022-06", "event": "Completed online data science courses"}, {"date": "2022-09", "event": "Started building portfolio projects"}, {"date": "2022-12", "event": "Submitted applications"}, {"date": "2023-03", "event": "Received admission offer"}, {"date": "2023-04", "event": "Scholarship notification"}]}', '{"GRE": {"verbal": 160, "quantitative": 165, "writing": 4.5}, "TOEFL": {"total": 108, "reading": 28, "listening": 27, "speaking": 26, "writing": 27}}', true, 'graduate', 'Data Science', ARRAY['MIT', 'Data Science', 'Career Change', 'Scholarship', 'Engineering'], 8, 'bca2f806-29c5-4be9-bc2d-a484671546cd'),

('Full Scholarship to Oxford: A Dream Come True', 'How strategic planning and persistence led to a full Rhodes Scholarship at Oxford University', 'An inspiring story of securing the prestigious Rhodes Scholarship for a DPhil in International Relations at Oxford University.', 'Marcus Johnson', 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'Political Science graduate with extensive research and leadership experience', 'BA in Political Science from Harvard University, summa cum laude (GPA: 3.95/4.0)', 'DPhil in International Relations', 'University of Oxford', 'United Kingdom', 'scholarship', 75000.00, 2023, 'Receiving the Rhodes Scholarship was the culmination of years of dedicated academic work, research, and community service. My journey began during my undergraduate years when I developed a passion for international relations and conflict resolution. I spent summers conducting research, interning at think tanks, and volunteering in conflict-affected regions. The Rhodes application process is notoriously competitive, requiring not just academic excellence but also leadership potential and commitment to service. My application highlighted my research on post-conflict reconstruction, my leadership roles in student government, and my volunteer work with refugee communities. The interview process was intense, but my preparation and genuine passion for my field helped me succeed.', ARRAY['Extremely competitive selection process', 'Balancing academics with extracurriculars', 'Demonstrating leadership and service', 'Articulating long-term vision'], ARRAY['Maintained exceptional academic performance', 'Conducted original research with publications', 'Led multiple student organizations', 'Volunteered extensively in relevant fields', 'Prepared thoroughly for interviews'], ARRAY['Excellence in academics is just the baseline', 'Develop a clear narrative connecting your experiences', 'Demonstrate genuine commitment to service', 'Practice articulating your vision clearly', 'Start building your profile early in undergraduate years'], '{"milestones": [{"date": "2021-09", "event": "Started Rhodes application preparation"}, {"date": "2022-02", "event": "Completed research project"}, {"date": "2022-06", "event": "Published paper in academic journal"}, {"date": "2022-09", "event": "Submitted Rhodes application"}, {"date": "2022-11", "event": "Selected for state-level interviews"}, {"date": "2022-12", "event": "National selection interviews"}, {"date": "2023-01", "event": "Rhodes Scholar announcement"}]}', '{"GRE": {"verbal": 168, "quantitative": 162, "writing": 5.5}, "IELTS": {"overall": 8.5, "listening": 9.0, "reading": 8.5, "writing": 8.0, "speaking": 8.5}}', true, 'phd', 'International Relations', ARRAY['Oxford', 'Rhodes Scholarship', 'Political Science', 'Full Scholarship', 'PhD'], 12, 'bca2f806-29c5-4be9-bc2d-a484671546cd'),

('Breaking Barriers: First-Generation College Student to Stanford MBA', 'Overcoming socioeconomic challenges to secure admission and funding for Stanford Graduate School of Business', 'An inspiring journey of a first-generation college student who overcame financial and social barriers to earn an MBA from Stanford.', 'Maria Rodriguez', 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'First-generation college graduate from a low-income family, worked full-time while studying', 'BS in Business Administration from state university (GPA: 3.8/4.0), worked multiple jobs during college', 'Master of Business Administration (MBA)', 'Stanford Graduate School of Business', 'United States', 'scholarship', 120000.00, 2023, 'As a first-generation college student from a low-income family, pursuing an MBA at Stanford seemed like an impossible dream. My parents worked multiple jobs to support our family, and I had to work throughout college to pay for my education. However, I was determined to break the cycle and create opportunities for myself and my family. My journey to Stanford involved years of preparation, including gaining relevant work experience, building leadership skills, and crafting a compelling narrative about my background and aspirations. The application process was challenging, especially writing essays that authentically conveyed my story without seeking pity. Stanford''s commitment to diversity and inclusion, combined with their generous financial aid program, made my dream a reality. I received a full scholarship that covers tuition, living expenses, and even provides a stipend for books and other necessities.', ARRAY['Financial constraints throughout education', 'Lack of family guidance on higher education', 'Balancing work and studies', 'Imposter syndrome in elite academic environments', 'Limited network and mentorship'], ARRAY['Worked multiple jobs to gain diverse experience', 'Sought mentorship from professors and professionals', 'Participated in leadership development programs', 'Crafted authentic personal narrative', 'Applied for numerous scholarships and grants'], ARRAY['Your background is your strength, not a weakness', 'Seek mentorship and don''t be afraid to ask for help', 'Start preparing early and be persistent', 'Apply for financial aid and scholarships aggressively', 'Believe in yourself and your unique perspective'], '{"milestones": [{"date": "2021-01", "event": "Started GMAT preparation"}, {"date": "2021-06", "event": "Took GMAT (Score: 720)"}, {"date": "2021-08", "event": "Began application essays"}, {"date": "2021-12", "event": "Submitted Stanford application"}, {"date": "2022-02", "event": "Interview invitation"}, {"date": "2022-03", "event": "Admission decision"}, {"date": "2022-04", "event": "Financial aid package confirmed"}]}', '{"GMAT": {"total": 720, "verbal": 42, "quantitative": 47, "writing": 5.5}, "TOEFL": {"total": 105, "reading": 27, "listening": 26, "speaking": 25, "writing": 27}}', true, 'graduate', 'Business Administration', ARRAY['Stanford', 'MBA', 'First Generation', 'Full Scholarship', 'Diversity'], 10, 'bca2f806-29c5-4be9-bc2d-a484671546cd'),

('From India to Cambridge: A Computer Science Success Story', 'How meticulous planning and strong academics led to admission at Cambridge University for MPhil in Computer Science', 'A detailed account of successfully navigating the competitive Cambridge application process for computer science.', 'Arjun Patel', 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'Computer Science student with strong academic background and research experience', 'B.Tech in Computer Science from IIT Bombay (CGPA: 9.2/10)', 'MPhil in Advanced Computer Science', 'University of Cambridge', 'United Kingdom', 'accepted', 0.00, 2023, 'Getting into Cambridge for computer science was a dream I had harbored since my undergraduate days at IIT Bombay. The application process for Cambridge is unique, requiring not just strong academics but also a clear research proposal and evidence of research potential. I spent months researching potential supervisors, reading their papers, and crafting a research proposal that aligned with my interests in machine learning and artificial intelligence. The interview process was particularly challenging, involving technical questions, discussions about my research proposal, and assessments of my problem-solving abilities. My strong academic record, combined with research experience and publications, helped me stand out in the competitive pool. While I didn''t receive funding initially, I was later awarded a partial scholarship from the university based on my academic merit.', ARRAY['Highly competitive admission process', 'Crafting a compelling research proposal', 'Finding the right supervisor match', 'Technical interview preparation', 'Funding challenges'], ARRAY['Researched extensively about potential supervisors', 'Developed a strong research proposal', 'Maintained excellent academic performance', 'Gained research experience through internships', 'Prepared thoroughly for technical interviews'], ARRAY['Research your potential supervisors thoroughly', 'Develop a clear and feasible research proposal', 'Maintain strong academic performance throughout', 'Gain research experience early', 'Prepare for technical depth in interviews'], '{"milestones": [{"date": "2022-06", "event": "Started researching Cambridge programs"}, {"date": "2022-08", "event": "Contacted potential supervisors"}, {"date": "2022-10", "event": "Submitted application"}, {"date": "2022-12", "event": "Interview invitation"}, {"date": "2023-01", "event": "Completed interviews"}, {"date": "2023-02", "event": "Admission offer received"}, {"date": "2023-05", "event": "Partial scholarship awarded"}]}', '{"GRE": {"verbal": 158, "quantitative": 170, "writing": 4.0}, "IELTS": {"overall": 8.0, "listening": 8.5, "reading": 8.5, "writing": 7.5, "speaking": 7.5}}', false, 'graduate', 'Computer Science', ARRAY['Cambridge', 'Computer Science', 'Research', 'MPhil', 'UK'], 9, 'bca2f806-29c5-4be9-bc2d-a484671546cd'),

('Medical School Dreams: From Rejection to Acceptance', 'How persistence and improvement led to medical school admission after initial rejection', 'A story of resilience and growth, showing how to bounce back from rejection and strengthen your medical school application.', 'Sarah Kim', 'https://images.unsplash.com/photo-1559839734-2b71ea197ec2?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'Pre-med student who faced initial rejection but persevered to achieve her goal', 'BS in Biology from UCLA (GPA: 3.6/4.0)', 'Doctor of Medicine (MD)', 'Johns Hopkins School of Medicine', 'United States', 'accepted', 0.00, 2024, 'My path to medical school wasn''t linear. After being rejected from all the schools I applied to in my first cycle, I was devastated but not defeated. I took a gap year to strengthen my application, focusing on areas where I was weak. I retook the MCAT, gained more clinical experience, and engaged in meaningful research. The rejection taught me valuable lessons about resilience, self-improvement, and the importance of a well-rounded application. When I reapplied the following year, I had a much stronger profile and a clearer understanding of why I wanted to pursue medicine. The acceptance to Johns Hopkins was validation that persistence and continuous improvement pay off. My experience taught me that rejection is not the end but an opportunity to grow and come back stronger.', ARRAY['Initial rejection from all applied schools', 'Low MCAT score in first attempt', 'Limited clinical experience', 'Weak research background', 'Self-doubt and motivation challenges'], ARRAY['Retook MCAT with intensive preparation', 'Gained extensive clinical experience', 'Conducted meaningful research with publications', 'Strengthened personal statement', 'Sought mentorship and feedback'], ARRAY['Don''t let rejection define you', 'Use gap years productively to strengthen weak areas', 'Seek honest feedback on your application', 'Gain meaningful experiences, not just check boxes', 'Persistence and improvement are key to success'], '{"milestones": [{"date": "2022-05", "event": "First cycle rejections"}, {"date": "2022-06", "event": "Started gap year planning"}, {"date": "2022-08", "event": "Began MCAT retake preparation"}, {"date": "2022-12", "event": "Retook MCAT (improved score)"}, {"date": "2023-06", "event": "Submitted improved applications"}, {"date": "2023-10", "event": "Interview invitations"}, {"date": "2024-03", "event": "Acceptance to Johns Hopkins"}]}', '{"MCAT": {"total": 515, "chemical": 128, "cars": 129, "biological": 130, "psychological": 128}, "first_attempt": {"total": 505}}', false, 'graduate', 'Medicine', ARRAY['Medical School', 'Rejection', 'Persistence', 'Johns Hopkins', 'MCAT'], 11, 'bca2f806-29c5-4be9-bc2d-a484671546cd'),

('Undergraduate Dreams: From Community College to Harvard', 'A transfer student''s journey from community college to Harvard University', 'An inspiring story of academic excellence and determination leading to successful transfer to Harvard as an undergraduate.', 'David Chen', 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&h=300&q=80', 'Community college student with exceptional academic performance and leadership', 'Associate Degree from Santa Monica College (GPA: 4.0/4.0)', 'Bachelor of Arts in Economics', 'Harvard University', 'United States', 'accepted', 0.00, 2023, 'Starting at community college wasn''t my first choice, but financial constraints made it necessary. However, I was determined to make the most of my situation and eventually transfer to a top university. At Santa Monica College, I maintained a perfect GPA while taking on leadership roles and engaging in research opportunities. The transfer application process to Harvard was incredibly competitive, requiring not just excellent grades but also compelling essays that explained my journey and aspirations. I had to demonstrate that despite starting at a community college, I had the academic rigor and intellectual curiosity to succeed at Harvard. My application highlighted my research work, community involvement, and the unique perspective I would bring as a transfer student. The acceptance to Harvard was a dream come true and validation that your starting point doesn''t determine your destination.', ARRAY['Financial constraints limiting initial college choices', 'Stigma associated with community college', 'Highly competitive transfer process', 'Limited research opportunities at community college', 'Proving academic readiness for elite institution'], ARRAY['Maintained perfect academic performance', 'Sought out research opportunities', 'Engaged in meaningful extracurricular activities', 'Built relationships with professors for recommendations', 'Crafted compelling transfer essays'], ARRAY['Excel academically wherever you start', 'Seek out opportunities beyond the classroom', 'Build strong relationships with faculty', 'Don''t let your starting point limit your aspirations', 'Use your unique journey as a strength in applications'], '{"milestones": [{"date": "2021-09", "event": "Started at Santa Monica College"}, {"date": "2022-01", "event": "Began transfer preparation"}, {"date": "2022-03", "event": "Started research project"}, {"date": "2022-11", "event": "Submitted Harvard transfer application"}, {"date": "2023-05", "event": "Received acceptance letter"}, {"date": "2023-08", "event": "Started at Harvard"}]}', '{"SAT": {"total": 1520, "math": 780, "reading_writing": 740}}', true, 'undergraduate', 'Economics', ARRAY['Harvard', 'Transfer', 'Community College', 'Economics', 'Undergraduate'], 7, 'bca2f806-29c5-4be9-bc2d-a484671546cd'); 